{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://open-plexus.dev/schema/plexus-pack.json",
  "title": "Open Plexus Content Pack",
  "type": "object",
  "required": ["pack", "mount_points", "events", "paintings"],
  "properties": {
    "pack": {
      "type": "object",
      "required": ["id", "name", "version", "author"],
      "properties": {
        "id": { "type": "string", "minLength": 3 },
        "name": { "type": "string", "minLength": 1 },
        "version": { "type": "string", "minLength": 1 },
        "author": { "type": "string", "minLength": 1 },
        "priority": { "type": "integer", "minimum": 0, "default": 100 }
      },
      "additionalProperties": false
    },
    "mount_points": {
      "type": "array",
      "items": { "$ref": "#/$defs/mountPoint" },
      "default": []
    },
    "events": {
      "type": "array",
      "items": { "$ref": "#/$defs/event" },
      "default": []
    },
    "paintings": {
      "type": "array",
      "items": { "$ref": "#/$defs/painting" },
      "default": []
    }
  },
  "$defs": {
    "phase": {
      "type": "string",
      "enum": ["early", "late", "any"],
      "default": "any"
    },
    "condition": {
      "type": "object",
      "properties": {
        "min_stars": { "type": "integer", "minimum": 0, "maximum": 120 },
        "max_stars": { "type": "integer", "minimum": 0, "maximum": 120 },
        "requires_flag": { "type": "string" },
        "forbids_flag": { "type": "string" }
      },
      "additionalProperties": false
    },
    "mountPoint": {
      "type": "object",
      "required": ["id", "castle_slot", "destination", "phase"],
      "properties": {
        "id": { "type": "string", "minLength": 3 },
        "castle_slot": { "type": "string", "minLength": 1 },
        "destination": {
          "type": "object",
          "required": ["level", "area", "warp_node"],
          "properties": {
            "level": { "type": "string", "minLength": 1 },
            "area": { "type": "integer", "minimum": 1 },
            "warp_node": { "type": "integer", "minimum": 0, "maximum": 255 }
          },
          "additionalProperties": false
        },
        "phase": { "$ref": "#/$defs/phase" },
        "weight": { "type": "integer", "minimum": 1, "default": 1 },
        "conditions": {
          "type": "array",
          "items": { "$ref": "#/$defs/condition" },
          "default": []
        }
      },
      "additionalProperties": false
    },
    "event": {
      "type": "object",
      "required": ["id", "type", "phase"],
      "properties": {
        "id": { "type": "string", "minLength": 3 },
        "type": {
          "type": "string",
          "enum": [
            "corridor_length_delta",
            "frame_palette_shift",
            "spawn_extra_door",
            "set_flag"
          ]
        },
        "phase": { "$ref": "#/$defs/phase" },
        "weight": { "type": "integer", "minimum": 1, "default": 1 },
        "once_per_save": { "type": "boolean", "default": true },
        "payload": { "type": "object" },
        "conditions": {
          "type": "array",
          "items": { "$ref": "#/$defs/condition" },
          "default": []
        }
      },
      "additionalProperties": false
    },
    "painting": {
      "type": "object",
      "required": ["id", "target_level", "visual_pool", "phase"],
      "properties": {
        "id": { "type": "string", "minLength": 3 },
        "target_level": { "type": "string", "minLength": 1 },
        "visual_pool": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 },
          "minItems": 1
        },
        "phase": { "$ref": "#/$defs/phase" },
        "weight": { "type": "integer", "minimum": 1, "default": 1 },
        "conditions": {
          "type": "array",
          "items": { "$ref": "#/$defs/condition" },
          "default": []
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
